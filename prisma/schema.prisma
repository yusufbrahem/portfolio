generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model SkillGroup {
  id              String       @id @default(uuid())
  portfolioId     String
  platformMenuId  String       // Section instance: which menu this content belongs to
  portfolio       Portfolio    @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  platformMenu    PlatformMenu @relation(fields: [platformMenuId], references: [id], onDelete: Cascade)
  name            String
  order           Int          @default(0)
  isVisible       Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  skills          Skill[]

  @@index([order])
  @@index([portfolioId])
  @@index([platformMenuId])
  @@index([portfolioId, platformMenuId])
  @@index([portfolioId, platformMenuId, order])
  @@index([portfolioId, isVisible])
}

model Skill {
  id           String     @id @default(uuid())
  skillGroupId String
  name         String
  order        Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  skillGroup   SkillGroup @relation(fields: [skillGroupId], references: [id], onDelete: Cascade)

  @@index([skillGroupId, order])
}

model Experience {
  id              String             @id @default(uuid())
  portfolioId     String
  platformMenuId  String             // Section instance: which menu this content belongs to
  portfolio       Portfolio          @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  platformMenu    PlatformMenu       @relation(fields: [platformMenuId], references: [id], onDelete: Cascade)
  title           String
  company         String
  location        String
  period          String
  order           Int                @default(0)
  isVisible       Boolean            @default(true)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  bullets         ExperienceBullet[]
  tech            ExperienceTech[]

  @@index([order])
  @@index([portfolioId])
  @@index([platformMenuId])
  @@index([portfolioId, platformMenuId])
  @@index([portfolioId, platformMenuId, order])
  @@index([portfolioId, isVisible])
}

model ExperienceBullet {
  id           String     @id @default(uuid())
  experienceId String
  text         String
  order        Int        @default(0)
  createdAt    DateTime   @default(now())
  experience   Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)

  @@index([experienceId, order])
}

model ExperienceTech {
  id           String     @id @default(uuid())
  experienceId String
  name         String
  order        Int        @default(0)
  createdAt    DateTime   @default(now())
  experience   Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)

  @@index([experienceId, order])
}

model Project {
  id              String          @id @default(uuid())
  portfolioId     String
  platformMenuId  String          // Section instance: which menu this content belongs to
  portfolio       Portfolio       @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  platformMenu    PlatformMenu    @relation(fields: [platformMenuId], references: [id], onDelete: Cascade)
  title           String
  summary         String
  order           Int             @default(0)
  isVisible       Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  bullets         ProjectBullet[]
  tags            ProjectTag[]

  @@index([order])
  @@index([portfolioId])
  @@index([platformMenuId])
  @@index([portfolioId, platformMenuId])
  @@index([portfolioId, platformMenuId, order])
  @@index([portfolioId, isVisible])
}

model ProjectBullet {
  id        String   @id @default(uuid())
  projectId String
  text      String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, order])
}

model ProjectTag {
  id        String   @id @default(uuid())
  projectId String
  name      String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, order])
}

model AboutContent {
  id              String           @id @default(uuid())
  portfolioId     String
  platformMenuId  String           // Section instance: which menu this content belongs to
  portfolio       Portfolio        @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  platformMenu    PlatformMenu     @relation(fields: [platformMenuId], references: [id], onDelete: Cascade)
  title           String
  paragraphs      String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  principles      AboutPrinciple[]

  @@unique([portfolioId, platformMenuId])
  @@index([portfolioId])
  @@index([platformMenuId])
}

model AboutPrinciple {
  id             String       @id @default(uuid())
  aboutContentId String
  title          String
  description    String
  order          Int          @default(0)
  createdAt      DateTime     @default(now())
  aboutContent   AboutContent @relation(fields: [aboutContentId], references: [id], onDelete: Cascade)

  @@index([aboutContentId, order])
}

model PersonInfo {
  id              String       @id @default(uuid())
  portfolioId     String
  platformMenuId  String       // Section instance: which menu (e.g. contact) this content belongs to
  portfolio       Portfolio    @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  platformMenu    PlatformMenu @relation(fields: [platformMenuId], references: [id], onDelete: Cascade)
  name           String
  role           String
  location       String
  email          String    // Legacy: kept for backward compatibility, maps to email1
  linkedIn       String
  phone          String?   // Legacy: kept for backward compatibility, maps to phone1
  contactMessage String?   // Optional custom contact message
  avatarUrl      String?   // Public URL to avatar image (per-portfolio)
  // Extended contact fields
  phone1         String?   // Primary phone number (E.164 format)
  phone2         String?   // Secondary phone number (E.164 format)
  whatsapp       String?   // WhatsApp number (E.164 format)
  email1         String?   // Primary email
  email2         String?   // Secondary email
  // Visibility controls for each contact field
  showPhone1     Boolean   @default(true) // Visibility toggle for phone1
  showPhone2     Boolean   @default(true) // Visibility toggle for phone2
  showWhatsApp   Boolean   @default(true) // Visibility toggle for WhatsApp
  showEmail1     Boolean   @default(true) // Visibility toggle for email1
  showEmail2     Boolean   @default(true) // Visibility toggle for email2
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  cvUrl          String?

  @@unique([portfolioId, platformMenuId])
  @@index([portfolioId])
  @@index([platformMenuId])
}

model HeroContent {
  id          String    @id @default(uuid())
  portfolioId String    @unique // Portfolio that owns this hero content (1-1)
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  headline    String
  subheadline String
  highlights  String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([portfolioId])
}

model ArchitectureContent {
  id              String               @id @default(uuid())
  portfolioId     String
  platformMenuId  String
  portfolio       Portfolio            @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  platformMenu    PlatformMenu         @relation(fields: [platformMenuId], references: [id], onDelete: Cascade)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  pillars         ArchitecturePillar[]

  @@unique([portfolioId, platformMenuId])
  @@index([portfolioId])
  @@index([platformMenuId])
}

model ArchitecturePillar {
  id                    String              @id @default(uuid())
  architectureContentId String
  title                 String
  order                 Int                 @default(0)
  isVisible             Boolean             @default(true) // Item-level visibility toggle
  createdAt             DateTime            @default(now())
  architectureContent   ArchitectureContent @relation(fields: [architectureContentId], references: [id], onDelete: Cascade)
  points                ArchitecturePoint[]

  @@index([architectureContentId, order])
  @@index([architectureContentId, isVisible])
}

model ArchitecturePoint {
  id                   String             @id @default(uuid())
  architecturePillarId String
  text                 String
  order                Int                @default(0)
  createdAt            DateTime           @default(now())
  architecturePillar   ArchitecturePillar @relation(fields: [architecturePillarId], references: [id], onDelete: Cascade)

  @@index([architecturePillarId, order])
}

model AdminUser {
  id                  String    @id @default(uuid())
  email               String    @unique
  passwordHash        String    // bcrypt hashed password
  name                String?   // Optional display name
  role                String    @default("user") // "super_admin" | "user"
  onboardingCompleted Boolean   @default(false) // Track if user has completed onboarding
  onboardingStep      Int       @default(0) // 0 = not started, 1-5 = current step, 6 = completed
  portfolio           Portfolio? // One portfolio per user (1-1 relationship)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
}

enum PortfolioStatus {
  DRAFT
  READY_FOR_REVIEW
  REJECTED
  PUBLISHED
}

model PlatformMenu {
  id                    String                @id @default(uuid())
  key                   String                @unique
  label                 String
  sectionType           String?               // Legacy: was section template; prefer componentKeys
  componentKeys         Json?                 // Ordered list of UI component keys, e.g. ["title","rich_text","contact_block"]
  order                 Int                   @default(0)  // Order in platform menu list (super admin)
  enabled               Boolean               @default(true)
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  portfolioMenus        PortfolioMenu[]
  skillGroups           SkillGroup[]
  experiences           Experience[]
  projects              Project[]
  aboutContents         AboutContent[]
  architectureContents  ArchitectureContent[]
  personInfos           PersonInfo[]

  @@index([key])
  @@index([enabled])
  @@index([sectionType])
  @@index([order])
}

model MenuBlock {
  id              String       @id @default(uuid())
  portfolioMenuId String      // Which menu (per portfolio) this block belongs to
  portfolioMenu   PortfolioMenu @relation(fields: [portfolioMenuId], references: [id], onDelete: Cascade)
  componentKey    String      // UI component type: title, rich_text, pill_list, etc.
  order           Int         @default(0)  // Order within the menu
  data            Json        @default("{}")  // Component-specific data (title text, paragraphs, etc.)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@unique([portfolioMenuId, order])
  @@index([portfolioMenuId])
  @@index([portfolioMenuId, order])
}

model PortfolioMenu {
  id               String        @id @default(uuid())
  portfolioId      String        // Portfolio that owns this menu configuration
  platformMenuId   String        // Reference to PlatformMenu
  portfolio        Portfolio     @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  platformMenu     PlatformMenu  @relation(fields: [platformMenuId], references: [id], onDelete: Cascade)
  visible          Boolean       @default(true)  // Draft: visibility user wants
  publishedVisible Boolean       @default(true)  // What is live on public portfolio
  order            Int           @default(0)     // Draft order
  publishedOrder   Int           @default(0)     // Order on public portfolio
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  menuBlocks       MenuBlock[]

  @@unique([portfolioId, platformMenuId])
  @@index([portfolioId])
  @@index([portfolioId, order])
  @@index([portfolioId, visible])
  @@index([portfolioId, publishedVisible])
  @@index([platformMenuId])
}

model Portfolio {
  id                String                @id @default(uuid())
  userId            String                @unique // One portfolio per user
  user              AdminUser             @relation(fields: [userId], references: [id], onDelete: Cascade)
  slug              String?               // URL-friendly identifier (e.g., "john-doe")
  isPublished       Boolean               @default(false) // Deprecated: use status instead
  status            PortfolioStatus       @default(DRAFT) // Portfolio lifecycle status
  rejectionReason   String?               // Reason for rejection (if status is REJECTED)
  requestedAt       DateTime?             // When user requested portfolio publication
  approvedAt        DateTime?             // When super admin approved the portfolio
  skillsIntro       String?               // Custom introduction for Skills section
  projectsIntro     String?               // Custom introduction for Projects section
  experienceIntro   String?               // Custom introduction for Experience section
  architectureIntro  String?               // Custom introduction for Architecture section
  isPublic          Boolean               @default(true) // Portfolio-level visibility (master control)
  showAbout         Boolean               @default(true) // Visibility toggle for About section
  showSkills        Boolean               @default(true) // Visibility toggle for Skills section
  showProjects      Boolean               @default(true) // Visibility toggle for Projects section
  showExperience    Boolean               @default(true) // Visibility toggle for Experience section
  showArchitecture  Boolean               @default(true) // Visibility toggle for Architecture section
  showContact       Boolean               @default(true) // Visibility toggle for Contact section
  skillGroups        SkillGroup[]
  experiences        Experience[]
  projects           Project[]
  aboutContents      AboutContent[]        // One per section instance (platform menu)
  heroContent        HeroContent?          // One per portfolio (hero is shared)
  personInfos        PersonInfo[]          // One per contact-type menu
  architectureContents ArchitectureContent[]
  portfolioMenus     PortfolioMenu[]
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  @@index([userId])
  @@index([slug])
  @@index([status])
}
