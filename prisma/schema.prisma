generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model SkillGroup {
  id          String     @id @default(uuid())
  portfolioId String     // Portfolio that owns this skill group
  portfolio   Portfolio  @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  name        String
  order       Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  skills      Skill[]

  @@index([order])
  @@index([portfolioId])
  @@index([portfolioId, order])
}

model Skill {
  id           String     @id @default(uuid())
  skillGroupId String
  name         String
  order        Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  skillGroup   SkillGroup @relation(fields: [skillGroupId], references: [id], onDelete: Cascade)

  @@index([skillGroupId, order])
}

model Experience {
  id          String             @id @default(uuid())
  portfolioId String             // Portfolio that owns this experience
  portfolio   Portfolio          @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  title       String
  company     String
  location    String
  period      String
  order       Int                @default(0)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  bullets     ExperienceBullet[]
  tech        ExperienceTech[]

  @@index([order])
  @@index([portfolioId])
  @@index([portfolioId, order])
}

model ExperienceBullet {
  id           String     @id @default(uuid())
  experienceId String
  text         String
  order        Int        @default(0)
  createdAt    DateTime   @default(now())
  experience   Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)

  @@index([experienceId, order])
}

model ExperienceTech {
  id           String     @id @default(uuid())
  experienceId String
  name         String
  order        Int        @default(0)
  createdAt    DateTime   @default(now())
  experience   Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)

  @@index([experienceId, order])
}

model Project {
  id          String          @id @default(uuid())
  portfolioId String          // Portfolio that owns this project
  portfolio   Portfolio       @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  title       String
  summary     String
  order       Int             @default(0)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  bullets     ProjectBullet[]
  tags        ProjectTag[]

  @@index([order])
  @@index([portfolioId])
  @@index([portfolioId, order])
}

model ProjectBullet {
  id        String   @id @default(uuid())
  projectId String
  text      String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, order])
}

model ProjectTag {
  id        String   @id @default(uuid())
  projectId String
  name      String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, order])
}

model AboutContent {
  id          String           @id @default(uuid())
  portfolioId String           @unique // Portfolio that owns this about content (1-1)
  portfolio   Portfolio        @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  title       String
  paragraphs  String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  principles  AboutPrinciple[]

  @@index([portfolioId])
}

model AboutPrinciple {
  id             String       @id @default(uuid())
  aboutContentId String
  title          String
  description    String
  order          Int          @default(0)
  createdAt      DateTime     @default(now())
  aboutContent   AboutContent @relation(fields: [aboutContentId], references: [id], onDelete: Cascade)

  @@index([aboutContentId, order])
}

model PersonInfo {
  id          String    @id @default(uuid())
  portfolioId String    @unique // Portfolio that owns this person info (1-1)
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  name        String
  role        String
  location    String
  email       String
  linkedIn    String
  avatarUrl   String?   // Public URL to avatar image (per-portfolio)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  cvUrl       String?

  @@index([portfolioId])
}

model HeroContent {
  id          String    @id @default(uuid())
  portfolioId String    @unique // Portfolio that owns this hero content (1-1)
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  headline    String
  subheadline String
  highlights  String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([portfolioId])
}

model ArchitectureContent {
  id          String               @id @default(uuid())
  portfolioId String               @unique // Portfolio that owns this architecture content (1-1)
  portfolio   Portfolio            @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  pillars     ArchitecturePillar[]

  @@index([portfolioId])
}

model ArchitecturePillar {
  id                    String              @id @default(uuid())
  architectureContentId String
  title                 String
  order                 Int                 @default(0)
  createdAt             DateTime            @default(now())
  architectureContent   ArchitectureContent @relation(fields: [architectureContentId], references: [id], onDelete: Cascade)
  points                ArchitecturePoint[]

  @@index([architectureContentId, order])
}

model ArchitecturePoint {
  id                   String             @id @default(uuid())
  architecturePillarId String
  text                 String
  order                Int                @default(0)
  createdAt            DateTime           @default(now())
  architecturePillar   ArchitecturePillar @relation(fields: [architecturePillarId], references: [id], onDelete: Cascade)

  @@index([architecturePillarId, order])
}

model AdminUser {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String    // bcrypt hashed password
  name         String?   // Optional display name
  role         String    @default("user") // "super_admin" | "user"
  portfolio    Portfolio? // One portfolio per user (1-1 relationship)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

enum PortfolioStatus {
  DRAFT
  READY_FOR_REVIEW
  REJECTED
  PUBLISHED
}

model Portfolio {
  id                String                @id @default(uuid())
  userId            String                @unique // One portfolio per user
  user              AdminUser             @relation(fields: [userId], references: [id], onDelete: Cascade)
  slug              String?               // URL-friendly identifier (e.g., "john-doe")
  isPublished       Boolean               @default(false) // Deprecated: use status instead
  status            PortfolioStatus       @default(DRAFT) // Portfolio lifecycle status
  rejectionReason   String?               // Reason for rejection (if status is REJECTED)
  skillGroups       SkillGroup[]          // Portfolio-specific skill groups
  experiences       Experience[]          // Portfolio-specific experience entries
  projects          Project[]             // Portfolio-specific projects
  aboutContent      AboutContent?         // Portfolio-specific about content (1-1)
  heroContent       HeroContent?          // Portfolio-specific hero content (1-1)
  personInfo        PersonInfo?           // Portfolio-specific person info (1-1)
  architectureContent ArchitectureContent? // Portfolio-specific architecture content (1-1)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  @@index([userId])
  @@index([slug])
  @@index([status])
}
